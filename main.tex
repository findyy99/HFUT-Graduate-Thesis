%ltxdoc！！
\documentclass[a4paper]{ltxdoc}
\usepackage[UTF8,fontset=windows,heading=true, scheme=plain, linespread=1.2, zihao=-4, fontset=fandol]{ctex}
\usepackage{xeCJK}
% ================加入数学公式============
\usepackage{amsmath}
% ================浮动体================
\usepackage{float}
\usepackage{verbatim}
% ===============amsmath与ctex字体冲突=======
\usepackage{lmodern}
%==============列表相关=================
% 列表定义
\usepackage{enumitem}
% 使用表格
\usepackage{array}
% =================页边距调整====================
\usepackage{geometry}
\geometry{left=3cm, right=3cm, top=2.54cm, bottom=2.54cm}
% ==============标题定义宏包=======
\usepackage{titletoc}
% ============公式按每个章节编号========
% \makeatletter
% \@addtoreset{equation}{section}
% \makeatother
% \renewcommand{\theequation}{\arabic{section}.\arabic{equation}}
\numberwithin{equation}{section} %https://blog.csdn.net/chen134225/article/details/78985537

\usepackage{parskip, seqsplit, fancyhdr, etoolbox, tocloft}
\usepackage{flafter, caption, multirow, graphicx}
\usepackage{minted} % 代码高亮模块，若不需要就删去
\usepackage[bottom]{footmisc} % 脚注放到页面最底部


\usepackage{hyperref}
\hypersetup{hidelinks} 

% =====counterwith重定义问题======
\let\counterwithout\relax 
\let\counterwithin\relax
\usepackage{chngcntr}
%=============图表编号================
\counterwithin{figure}{section} % 图的编号按section编排
\counterwithin{table}{section} % 表的编号按section编排
% 自定义图表的标题
\DeclareCaptionFormat{smallformat}{\songti \small #1#2#3} % 宋体，五号

\input{self_info/self_info.tex}

\captionsetup{
	labelsep=quad, % caption去掉分隔符: %标号与列表项的距离
	textformat=simple,
	format=smallformat,
}


% \setlength{\headheight}{21.18314pt}

% ===============定义每章标题的格式=================
\ctexset{
	space=auto,
	section = {
		%format用于设置章节标题全局格式，作用域为标题和编号
		%字号为小三，字体为黑体，左对齐
		%+号表示在原有格式下附加格式命令
		format = \centering \heiti \sanhao \bfseries,
		%aftername用于控制编号和标题之间的格式
		%\hspace用于增加水平间距
		aftername = \hspace{0.5em},
		afterindent = true,
	},
	subsection = {
%		format = \heiti \bfseries,
		format = \heiti \xiaosihao,
		aftername = \hspace{0.4em},
		afterindent = true,
	},
	subsubsection = {
		format = \songti \bfseries \xiaosihao,
		aftername = \hspace{0.4em},
		afterindent = true,
	},
}

% =========设置默认英文字体========

\setmainfont{Times New Roman} 


\begin{document}
% 插入封面
\include{tex/cover}
% 插入中文标题
\include{tex/chinese_title}
% 插入英文标题
\include{tex/english_title}
% 插入独立完成声明
\include{tex/statement}
% 插入摘要
\include{tex/abstract.tex}


% https://www.moonpapers.com/manual/latex/senior/catalog/style.html
% ======定义目录、图片、表格清单========
\begingroup
    \baselineskip=22pt %目录、图片、表格清单间距22pt
    {
        \tocloftpagestyle{empty} %目录不出现页码

        \setlength{\cftfignumwidth}{3.5em} %设置figu间隔
        \setlength{\cfttabnumwidth}{3.5em}
        \clearpage

        \titlecontents{section}[0em]{\heiti } %设置章节的格式
        {\thecontentslabel\ }{}
        {\hspace{.5em}\titlerule*[4pt]{$\cdot$}\contentspage}

        \tableofcontents
        \addtocontents{toc}{\protect\thispagestyle{empty}}
        \pagenumbering{roman}

        \clearpage
        \listoffigures

        \clearpage
        \listoftables

        \pagenumbering{arabic}
    }
\endgroup





% ===========设置页眉==========
\newgeometry{left=2.54cm, right=2.54cm, top=3cm, bottom=3cm}
\fancyhead{}
\chead{\small 合肥工业大学毕业设计（论文）\vspace{0.3cm}}
\pagestyle{fancy}
%===========设置页码为1=======
\setcounter{page}{1}


% ======重写section指令以便设置====
% ======section段前1行间距，分页=====
\pretocmd{\section}{\clearpage \vspace*{-2.0em}}{}{}
\setlength{\parindent}{2em}
\setlength{\parskip}{0.5em}
\setlength{\baselineskip}{22pt}


% 插入正文
\include{tex/demo.tex}
% 插入参考文献
\include{bib/bib.tex}
% 插入致谢
\include{tex/th.tex}
% 插入附录
\include{tex/append.tex}

\end{document}
